#!@PYTHON@

import sys
import re

#Numeric comparison sorting
def sorttestnum(lhs, rhs):
    return int(lhs) - int(rhs)


#
#	Compress sorted list of tests into runs (ranges) of sequential tests
#	So that (1,2,3,4) gets compressed down into (1,5)
#	We add one so we get the marker showing the beginning of the next test
#
#	
#
def testruns(list):
    if len(list) < 1:
        return None, None
    first=int(list.pop(0))
    last=first+1
    while len(list) >= 1 and list[0] == last:
        last=list.pop(0)+1
    return (int(first), int(last))
     
       

#
#	Scanning for particular tests...
#
class ExtractTests:
    def __init__(self, filename, testlist):
        self.file = open(filename, "r")
        testlist.sort(sorttestnum)
        self.testlist = testlist
        print "Extracting tests ", self.testlist
        self.regex=re.compile("CTS: Running test .*\[([0-9]+)")

    def __call__(self):
        first, last = testruns(self.testlist)
        curtest=1
        while 1:
            line = self.file.readline()
            if line == None:
                break
            mobj=self.regex.search(line)
            if mobj:
                curtest= int(mobj.groups()[0])
            if curtest >= first:
                sys.stdout.write(line)
            if curtest >= last:
                first, last = testruns(self.testlist)
                if first == None:
                    break

if len(sys.argv) < 3:
    print "Usage:", sys.argv[0] , "logfilename testnumber ..."
    sys.exit(1)
foo = ExtractTests (sys.argv[1], sys.argv[2:])
foo()
